--1ST QUERY
-- LIST ALL EMPS,DEPTS DETAILS WHICH DEPT HAS ATLEAST 1 OR MORE EMPLOYEES

SELECT *FROM EMP WHERE DNO IN(SELECT DNO FROM DEPT WHERE DNO=E.DNO)
SELECT *FROM EMP
SELECT *FROM DEPT WHERE DNO NOT IN(SELECT DNO FROM EMP)
SELECT *FROM DEPT


 --2ND QUERY
 --LIST ALL EMP,PROJECTS DETAILS WHERE EMPID MATCHES WITH PID

SELECT  EMP.EID,EMP.ENAME ,PROJECTS.PID,PROJECTS.PNAME FROM EMP INNER JOIN PROJECTS ON EMP.EID=PROJECTS.PID

-- 3RD QUERY
--TO GET TOTAL SUM OF SALARIES BASED ON DEPTNO WISE

SELECT DNO,SUM(SALARY) AS SALARY FROM  EMP  GROUP BY DNO

--4TH QUERY
-- WHICH DEPT DOES NOT EXISTS ANY EMP THOSE DETAILS?

SELECT DNAME FROM DEPT WHERE DNO NOT IN(SELECT DNO FROM EMP)

--5TH QUERY
--LIST 5TH MINIMUM SALARY EMP DETAILS USING NTH QUERY METHOD

SELECT *FROM EMP E WHERE 4=(SELECT COUNT(DISTINCT SALARY) FROM EMP WHERE SALARY<E.SALARY)

--6TH QUERY
--LIST WHICH EMPLOYEES TWO SALARIES ARE SAME

SELECT SALARY,EID,ENAME FROM EMP WHERE SALARY IN(SELECT SALARY FROM EMPS GROUP BY  SALARY HAVING COUNT(*)>1) 

--7TH QUERY
--INSERT EMP DETAILS USING PROCEDURE IF EID IS UNIQUE,ENAME IS NOT NULL,SALARY GREATER THAN 12000 ?

CREATE PROC PC(@EID INT,@ENAME VARCHAR(10),@SALARY INT )   -- PROCEDURE NAMED AS PC
AS
BEGIN
SET NOCOUNT ON                               -- DOESNOT DISPLAYS ROWS INSERTED 
DECLARE @I INT
SELECT @I =COUNT(*)FROM EMP WHERE EID=@EID
IF @EID=0 
PRINT 'CANT INSERT NULL VALUE INTO EID'
ELSE IF @I>0                                 -- CHECKS @I>0
PRINT 'EID ALREADY EXISTS'
ELSE IF @ENAME IS NULL                       -- CHECKS ENAME COLOUMN IS NULL
PRINT 'CANT INSERT NULL VALUE INTO ENAME'
ELSE IF @SALARY<12000                        -- CHECKS CONDITION WHERE SALARY <12000
PRINT 'SALARY SHOULD BE GREATER THAN 12000' 
ELSE
BEGIN
INSERT INTO EMP(EID,ENAME,SALARY) VALUES(@EID,@ENAME,@SALARY)
PRINT 'RECORD INSERTED SUCCESSFULLY'
END
END
EXEC PC 1000,'KARTHIK',14000  -- RECORD INSERTED SUCCESSFULLY
EXEC PC 1111,'RAMS',300 -- CANT INSERT SALARY SHOULD BE GREATER THAN 12000
EXEC PC 106,'WRIDI',400 -- EID ALREADY EXISTS
EXEC PC 1010,NULL,12999  -- CANT INSERT NULL VALUE INTO ENAME
EXEC PC 2,'MANISH',12111  --- EID 2 ALREADY EXISTS


-- 8TH QUERY
-- LIST EMP MONTHLYSALARY,ANNUAL SALARY AND SAVE AS VIEW
--CREATING A VIEW TO SELECT EID,SALARY FROM EMPS TABLE AND  TO CALCULATE AS ANNUAL,MONTHLY SALARY

CREATE VIEW VIEW1 AS SELECT EID,SALARY AS MONTHLYSALARY,(SALARY*12) AS ANNUALSALARY FROM EMP
SELECT *FROM VIEW1 --SELECTING VIEW1


-- 9TH QUERY
--CREATE ONE NEW EMPTABLE IN THAT TO STORE INSERTED,DELETED USING TRIGGER.

CREATE TABLE EMP2(EID INT,ENAME VARCHAR(10) NOT NULL,SALARY INT CHECK (SALARY BETWEEN 10000 AND 50000),DNO INT) --APPLYING CONSTRAINTS
SELECT *FROM EMP2
CREATE TRIGGER TR4 -- TRIGGER NAMED TR4
ON EMP
FOR INSERT
AS
BEGIN
INSERT INTO EMP2 SELECT EID,ENAME,SALARY,DNO FROM INSERTED  
END
INSERT INTO EMP(EID,ENAME,SALARY,DNO) VALUES(133,'ABHIMANYU',30000,10) --INSERTING VALUES INTO NAMED 4 COLOUMNS
INSERT INTO EMP(EID,ENAME,SALARY,DNO) VALUES(134,'ABHIJIT',25000,10) -- INSERTING VALUES INTO NAMED 4 COLOUMNS
SELECT *FROM EMP

CREATE TABLE EMP3(EID INT,ENAME VARCHAR(10) NOT NULL,SALARY INT CHECK(SALARY BETWEEN 10000 AND 50000),DNO INT)
SELECT *FROM EMP3
CREATE TRIGGER TR5  -- TRIGGER NAMED TR5
ON EMP
FOR DELETE
AS
BEGIN
INSERT INTO EMP3 SELECT EID,ENAME,SALARY,DNO FROM DELETED
END
DELETE FROM EMP WHERE EID=134  -- DELETES  EID RECORD
SELECT *FROM EMP   -- RETRIEVE EMPS DETAILS


--10TH QUERY
--TO MAKE TAX()FUNCTION FOR GIVEN SALARY WITH 13%

CREATE FUNCTION TAX(@SALARY INT)
RETURNS FLOAT  -- RETURNS FLOAT DATAYPE
BEGIN
SET @SALARY=@SALARY+(@SALARY*0.13) -- TO CALCULATE SALARY WITH 13%
RETURN @SALARY
END 
SELECT dbo.TAX(SALARY) FROM EMP    -- dbo is DATABASE OWNER WITH EXTENSION OF TAX FUNCTION